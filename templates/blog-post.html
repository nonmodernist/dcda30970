{% extends "_base.html" %}

{% block title %}{{ page.title }} | {{ config.title }}{% endblock %}

{% block content %}
<article class="blog-post {% if page.extra.author == 'Dr. Edwards' %}instructor-post{% else %}student-post{% endif %}">
    <!-- HEADER -->
    <header class="blog-post-header">
        <h1 class="blog-post-title">{{ page.title }}</h1>
        
        <div class="blog-post-meta">
            {% if page.extra.author %}
            <div class="blog-post-author">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                {{ page.extra.author }}
            </div>
            {% endif %}
            
            {% if page.date %}
            <div class="blog-post-date">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                {{ page.date | date(format="%B %d, %Y") }}
            </div>
            {% endif %}
        </div>
        
        {% if page.description %}
        <div class="blog-post-description">
            {{ page.description }}
        </div>
        {% endif %}
    </header>
    
    <!-- CONTENT -->
    <div class="blog-post-content">
        {{ page.content | safe }}
    </div>
    
    <!-- TAGS -->
    {% if page.taxonomies and page.taxonomies.tags %}
    <div class="blog-post-tags">
        <h3>Tags:</h3>
        <div class="tag-list">
            {% for tag in page.taxonomies.tags %}
                <a href="{{ get_taxonomy_url(kind='tags', name=tag) }}" class="blog-tag">{{ tag }}</a>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    
    <!-- NAVIGATION -->
    <nav class="blog-post-navigation">
        {% if page.earlier %}
        <div class="blog-post-prev">
            <div class="nav-label">Previous Post</div>
            <a href="{{ page.earlier.permalink }}" class="nav-title">{{ page.earlier.title }}</a>
        </div>
        {% endif %}
        
        {% if page.later %}
        <div class="blog-post-next">
            <div class="nav-label">Next Post</div>
            <a href="{{ page.later.permalink }}" class="nav-title">{{ page.later.title }}</a>
        </div>
        {% endif %}
    </nav>
</article>

<!-- RELATED POSTS -->
{% if page.taxonomies and page.taxonomies.tags %}
    {% set related_posts = [] %}
    {% set current_path = page.path %}
    {% set current_tags = page.taxonomies.tags %}
    
    {% for post in get_section(path="_index.md") %}
        {% if post.path != current_path and post.taxonomies and post.taxonomies.tags %}
            {% set common_tags = post.taxonomies.tags | intersect(with=current_tags) %}
            {% if common_tags | length > 0 %}
                {% set related_posts = related_posts | concat(with=[post]) %}
            {% endif %}
        {% endif %}
    {% endfor %}
    
    {% if related_posts | length > 0 %}
    <div class="related-posts">
        <h2>Related Posts</h2>
        <div class="blog-list">
            {% for related in related_posts | slice(end=3) %}
                <article class="blog-card {% if related.extra.author == 'Dr. Edwards' %}instructor-post{% else %}student-post{% endif %}">
                    <div class="blog-card-content">
                        <h3 class="blog-card-title">
                            <a href="{{ related.permalink }}">{{ related.title }}</a>
                        </h3>
                        
                        <div class="blog-card-meta">
                            <span class="blog-card-author">{{ related.extra.author | default(value="Anonymous") }}</span>
                            <span class="blog-card-date">{{ related.date | date(format="%B %d, %Y") }}</span>
                        </div>
                        
                        {% if related.taxonomies and related.taxonomies.tags %}
                            <div class="blog-card-tags">
                                {% for tag in related.taxonomies.tags %}
                                    <a href="{{ get_taxonomy_url(kind='tags', name=tag) }}" class="blog-tag">{{ tag }}</a>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                </article>
            {% endfor %}
        </div>
    </div>
    {% endif %}
{% endif %}
{% endblock content %}